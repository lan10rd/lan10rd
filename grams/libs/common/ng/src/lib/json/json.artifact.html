<ul
>

    <div
    class="flex"
    >

        <common-ng-button-element
        class="flex fit pt pb glo-0-text-ani"
        [ngClass]="{'glo-0-shadow': dotdotdot.toggle}"
        #dotdotdot
        >
            <span class="glo-0-text-trim">...</span>
        </common-ng-button-element>

        <ng-container
        *ngIf="dotdotdot.toggle"
        >

            <ng-container
            [ngSwitch]="type"
            >

                <ng-container
                *ngSwitchCase="'obj'"
                >

                    <common-ng-select-element
                    class="ib glo-0-text-trim"
                    [scrollClasses]="'scrollable'"
                    [options]="['add', 'remove', 'mode']"
                    #objOptions
                    ></common-ng-select-element>

                    <ng-container
                    [ngSwitch]="objOptions._option"
                    >

                        <ng-container
                        *ngSwitchCase="'add'"
                        >
                            add
                        </ng-container>

                        <ng-container
                        *ngSwitchCase="'remove'"
                        >
                            remove
                        </ng-container>
                        
                        <ng-container
                        *ngSwitchCase="'mode'"
                        >
                            mode
                        </ng-container>

                    </ng-container>

                    <div
                    *ngIf="objOptions._option === ''"
                    >
                        <input
                        class="bl"
                        #addFieldKey
                        (keyup.enter)="addField(addFieldKey.value, addFieldValue.value); addFieldKey.value = ''; addFieldValue.value = '';"
                        >

                        <textarea
                        #addFieldValue
                        ></textarea>

                        <common-ng-button-element
                        (click)="addField(addFieldKey.value, addFieldValue.value); addFieldKey.value = ''; addFieldValue.value = ''; dotdotdot.toggle = false"
                        >
                            add
                        </common-ng-button-element>

                    </div>
                </ng-container>

                <ng-container
                *ngSwitchCase="'arr'"
                >

                    <common-ng-select-element
                    class="ib glo-0-text-trim"
                    [scrollClasses]="'scrollable'"
                    [options]="['insert', 'remove', 'swap']"
                    #arrOptions
                    ></common-ng-select-element>

                    <div
                    [ngSwitch]="arrOptions._option"
                    >

                        <ng-container
                        *ngSwitchCase="'insert'"
                        >
                            <textarea
                            #insertTextarea
                            ></textarea>

                            <div>inserted at position (index): <input min="0" max="{{keys.length}}" step="1" type="number" value="0" #insertIndex></div>

                            <common-ng-button-element
                            class="bl glo-0-text-ani glo-0-text-trim tcenter"
                            (click)="insert(insertTextarea.value, insertIndex.value)"
                            >
                                insert
                            </common-ng-button-element>

                        </ng-container>

                        <ng-container
                        *ngSwitchCase="'remove'"
                        >

                            <div>remove at position (index): <input min="0" max="{{keys.length - 1}}" step="1" type="number" value="0" #removeIndex></div>

                            <common-ng-button-element
                            class="bl glo-0-text-ani glo-0-text-trim tcenter"
                            (click)="remove(removeIndex.value)"
                            >
                                remove
                            </common-ng-button-element>

                        </ng-container>

                        <ng-container
                        *ngSwitchCase="'swap'"
                        >
                            swap
                        </ng-container>

                    </div>

                </ng-container>

            </ng-container>

        </ng-container>

    </div>

    <ng-container
    *ngFor="let key of keys; let i=index; trackBy: json.trackBy"
    >


            <li
            >

                <common-ng-button-element
                *ngIf="!editing.keys.includes(key)"
                class="bl glo-0-text-ani fit center"
                (click)="toggleEditKey(key)"
                >
                    {{key}}
                </common-ng-button-element>

                <!-- <div
                [ngClass]="{'hover': type === 'obj'}"
                *ngIf="!editing.keys.includes(key)"
                (click)="toggleEditKey(key)"
                (keyup.enter)="toggleEditKey(key)"
                style="width: fit-content"
                tabindex="0"
                >
                    {{key}} 
                </div> -->

                <div
                [ngClass]="{'hidden': !editing.keys.includes(key)}"
                >

                    <input
                    class="bl"
                    #keysi
                    (focusout)="editing.keys = json.remove(editing.keys, key)"
                    [ngModel]="keys[i]"
                    (keyup.enter)="editing.keys = json.remove(editing.keys, key); changeKey(keysi.value, i)"
                    >
                    
                    <select (change)="handleMode(modeSelect.value, key);" #modeSelect>
                        <option [ngValue]="'pretty'">pretty</option>
                        <option [ngValue]="'raw'">raw</option>
                    </select>

                    <button (click)="model[key] = json.parse(editing.values[key])" *ngIf="modeSelect.value === 'raw'">save</button>

                    
                </div>

                <ng-container
                [ngSwitch]="modeSelect.value"
                >
                
                    <ng-container
                    *ngSwitchCase="'pretty'"
                    >
                        <ng-container
                        [ngSwitch]="json.typeOf(model[key])"
                        >

                            <textarea
                            *ngSwitchCase="'str'"
                            [(ngModel)]="model[key]"
                            ></textarea>

                            <input
                            *ngSwitchCase="'num'"
                            [(ngModel)]="model[key]"
                            type="number"
                            >

                            <ng-container
                            *ngSwitchCase="'boo'"
                            >
                                {{model[key]}}
                            </ng-container>

                            <common-ng-json-artifact
                            *ngSwitchDefault
                            [(model)]="model[key]"
                            ></common-ng-json-artifact>

                        </ng-container>
                    </ng-container>

                    <ng-container
                    *ngSwitchCase="'raw'"
                    >

                        <textarea
                        [(ngModel)]="editing.values[key]"
                        ></textarea>

                    </ng-container>

                </ng-container>

            </li>

    </ng-container>

</ul>